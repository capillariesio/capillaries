<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
						http://activemq.apache.org/schema/core http://activemq.apache.org/schema/core/activemq-core.xsd">
	<bean class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
		<property name="locations">
			<value>file:${activemq.conf}/credentials.properties</value>
		</property>
	</bean>
	<broker xmlns="http://activemq.apache.org/schema/core" brokerName="localhost" dataDirectory="${activemq.data}" schedulerSupport="true">
		<destinationPolicy>
			<policyMap>
				<policyEntries>
					<policyEntry topic=">">
						<pendingMessageLimitStrategy>
							<constantPendingMessageLimitStrategy limit="1000" />
						</pendingMessageLimitStrategy>
					</policyEntry>
				</policyEntries>
			</policyMap>
		</destinationPolicy>
		<managementContext>
			<managementContext createConnector="false" />
		</managementContext>
		<persistenceAdapter>
			<kahaDB directory="${activemq.data}/kahadb" />
		</persistenceAdapter>
		<systemUsage>
			<systemUsage>
				<memoryUsage>
					<memoryUsage percentOfJvmHeap="70" />
				</memoryUsage>
				<storeUsage>
					<storeUsage limit="100 gb" />
				</storeUsage>
				<tempUsage>
					<tempUsage limit="50 gb" />
				</tempUsage>
			</systemUsage>
		</systemUsage>
		<transportConnectors>
			<transportConnector name="openwire" uri="tcp://0.0.0.0:61616?maximumConnections=1000&amp;wireFormat.maxFrameSize=104857600" />
			<transportConnector name="amqp" uri="amqp://0.0.0.0:5672?maximumConnections=1000&amp;wireFormat.maxFrameSize=104857600" />
			<transportConnector name="stomp" uri="stomp://0.0.0.0:61613?maximumConnections=1000&amp;wireFormat.maxFrameSize=104857600" />
			<transportConnector name="mqtt" uri="mqtt://0.0.0.0:1883?maximumConnections=1000&amp;wireFormat.maxFrameSize=104857600" />
			<transportConnector name="ws" uri="ws://0.0.0.0:61614?maximumConnections=1000&amp;wireFormat.maxFrameSize=104857600" />
		</transportConnectors>
		<shutdownHooks>
			<bean xmlns="http://www.springframework.org/schema/beans" class="org.apache.activemq.hooks.SpringContextHook" />
		</shutdownHooks>
		<plugins>
			<!-- added -->
			<redeliveryPlugin>
				<redeliveryPolicyMap>
					<redeliveryPolicyMap>
						<redeliveryPolicyEntries>
							<redeliveryPolicy queue="capillaries" maximumRedeliveries="-1" initialRedeliveryDelay="5000" redeliveryDelay="5000" />
						</redeliveryPolicyEntries>

						<defaultEntry>
							<redeliveryPolicy maximumRedeliveries="-1" initialRedeliveryDelay="5000" redeliveryDelay="5000" />
						</defaultEntry>
					</redeliveryPolicyMap>
				</redeliveryPolicyMap>
			</redeliveryPlugin>
			<simpleAuthenticationPlugin anonymousAccessAllowed="false">
				<users>
					<authenticationUser username="guest" password="guest" groups="users"/>
				</users>
			</simpleAuthenticationPlugin>
		</plugins>
	</broker>
	<import resource="jetty.xml" />
</beans>